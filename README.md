# ğŸ…¿ï¸ PenbunAPI v1.0.2 Stable

PenbunAPI is a RESTful API designed to manage the distribution and supply of books and stationery.  
It provides robust features for inventory management, order processing, and user authentication using JWT.

---

## ğŸ“˜ Development Standards (v1.0.2)

### Core Principles (Thin API)

- API logic kept minimal: business rules, code generation, and timestamps handled by DB triggers and WinApp.
- Consistent response format across all endpoints.
- Transaction safety enforced via `utils.ExecuteTransaction`.

### Response Shape

```json
{
  "status": "success | error",
  "message": "short message",
  "data": { ... } // or null
}
```

### Authentication Response

**Login (`/api/v1/public/login`)**

```json
{
  "status": "success | fail | error",
  "token": "jwt_token_string",
  "message": "Login successful",
  "error": "Error message (if fail/error)"
}
```

**Logout (`/api/v1/public/logout`)**

```json
{
  "status": "success | fail | error",
  "message": "Logged out successfully",
  "error": "Error message (if fail/error)"
}
```

### Database Conventions

- `update_date` handled by Trigger with `SE Asia Standard Time`.
- `is_delete BIT` (0 = No, 1 = Yes) for soft delete.
- `id_status BIT` (1 = Active, 0 = Inactive, default 1).
- Business codes generated by Trigger (e.g., `PTG000001`).

### CRUD Pattern

1. **Select All** â€“ always `WHERE is_delete = 0`
2. **Select Page** â€“ support `?page=&limit=` params
3. **Select By ID/Name** â€“ allow `LIKE` searches
4. **Insert** â€“ send only business fields, return minimal response (e.g. `{ "group_name": "LEGO" }`)
5. **Update** â€“ use `COALESCE(NULLIF(...))` for partial updates
6. **Soft Delete** â€“ mark `is_delete=1`, update_by recorded
7. **Hard Delete** â€“ physical deletion

### Logging Standard

- Every transaction logged under `logs/transaction.log` (configurable via `LOG_FILE` or `TRANSACTION_LOG_FILE`).
- Format includes step count, duration, rollback/commit results.

### Example Response

```json
{
  "status": "success",
  "message": "Product type group updated successfully",
  "data": { "group_name": "LEGO Updated" }
}
```

---

## ğŸš€ Features

- **Authentication** â€“ JWT-based secure access.
- **Publisher / Customer / Vendor / Discount / Book APIs** â€“ Full CRUD + Paging + Search.
- **Consistent Master Data APIs** â€“ All modules implement 8 standard functions.
- **Logging** â€“ Transaction logs for audit.
- **Versioned API** â€“ v1, v2 support.
- **Graceful Shutdown** â€“ Safe server stop and cleanup.
- **Frontend: Save/Update Confirmation** â€“ Global confirmation with checkbox for data integrity.

---

## âš™ï¸ Fundamental Functions

Each master module has 8 functions:

| #   | Function         | Description                           |
| --- | ---------------- | ------------------------------------- |
| 1   | Select All       | All records with `is_delete = 0`      |
| 2   | Select By Paging | Query with `?page=&limit=`            |
| 3   | Select By ID     | Record by code/id                     |
| 4   | Select By Name   | Search by LIKE `%name%`               |
| 5   | Insert           | Add new record                        |
| 6   | Update By ID     | Update by ID (no auto fields touched) |
| 7   | Delete By ID     | Soft delete (is_delete=1)             |
| 8   | Remove By ID     | Hard delete                           |

---

## ğŸ§© **Project Structure**

```
PenbunAPI/
â”œâ”€â”€ main.go
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ database.go           # Database connection setup
â”‚   â”œâ”€â”€ blacklist.go          # Token blacklist
â”‚   â”œâ”€â”€ env.go                # Environment variable management
â”‚   â””â”€â”€ logger.go             # Log configuration
â”‚
â”œâ”€â”€ controllers/
â”‚   â”œâ”€â”€ auth.go               # Authentication endpoints
â”‚   â”œâ”€â”€ books.go              # Book management endpoints
â”‚   â”œâ”€â”€ publishers.go         # Publisher management endpoints
â”‚   â”œâ”€â”€ publisherType.go      # Publisher Type management endpoints
â”‚   â”œâ”€â”€ references.go         # Reference management endpoints
â”‚   â”œâ”€â”€ customer.go           # Customer management endpoints
â”‚   â”œâ”€â”€ customerType.go       # Customer Type management endpoints
â”‚   â”œâ”€â”€ book.go               # Book management endpoints
â”‚   â”œâ”€â”€ bookType.go           # Book Type management endpoints
â”‚   â”œâ”€â”€ discountType.go       # Discount Type management endpoints
â”‚   â”œâ”€â”€ discount.go           # Discount management endpoints
â”‚   â”œâ”€â”€ unitType.go           # Product Type management endpoints
â”‚   â”œâ”€â”€ productTypeGroup.go   # Product Type Group management endpoints
â”‚   â”œâ”€â”€ productType.go        # Product Type management endpoints
â”‚   â”œâ”€â”€ vendorType.go         # Vendor Type management endpoints
â”‚   â””â”€â”€ vendor.go             # Vendor management endpoints
â”‚
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ user.go               # User-related structs and logic
â”‚   â”œâ”€â”€ book.go               # Book-related structs and logic
â”‚   â”œâ”€â”€ bookType.go           # Book Type-related structs and logic
â”‚   â”œâ”€â”€ publisher.go          # Publisher-related structs and logic
â”‚   â”œâ”€â”€ publisherType.go      # Publisher Type-related structs and logic
â”‚   â”œâ”€â”€ references.go         # Reference-related structs and logic
â”‚   â”œâ”€â”€ book.go               # Book management structs and logic
â”‚   â”œâ”€â”€ bookType.go           # Book Type management structs and logic
â”‚   â”œâ”€â”€ discountType.go       # Discount Type management structs and logic
â”‚   â”œâ”€â”€ discount.go           # Discount management structs and logic
â”‚   â”œâ”€â”€ unitType.go           # Product Type management endpoints
â”‚   â”œâ”€â”€ productType.go        # Product Type management endpoints
â”‚   â”œâ”€â”€ productTypeGroup.go   # Product Type Group management endpoints
â”‚   â”œâ”€â”€ vendorType.go         # Vendor Type management structs and logic
â”‚   â””â”€â”€ vendor.go             # Vendor management structs and logic
â”‚
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ public.go             # Public API version routes
â”‚   â”œâ”€â”€ v1.go                 # API version 1 routes and grouping
â”‚   â””â”€â”€ v2.go                 # API version 2 routes (placeholder)
â”‚
â”œâ”€â”€ middleware/
â”‚   â””â”€â”€ jwt.go                # JWT middleware for secure endpoints
â”‚
â”œâ”€â”€ logs/
â”‚   â””â”€â”€ transaction.log       # Log file for transactions
â”‚
â”œâ”€â”€ .env                      # Environment variables
â”‚
â””â”€â”€ go.mod                    # Go module file
```

---

## ğŸ’½ Libraries

- Fiber (Go Web Framework)
- go-mssqldb (SQL Server driver)
- golang-jwt (JWT)
- bcrypt (password hashing)
- godotenv (env loader)

---

## ğŸ’¾ Installation

1. Clone repository
2. Run `go mod tidy`
3. Configure `.env` (DB credentials, JWT secret, log path)
4. Run server: `go run main.go`

---

## ğŸ§ª Example Insert (ProductTypeGroup)

Request:

```json
{
  "group_name": "LEGO",
  "description": "à¸à¸¥à¸¸à¹ˆà¸¡à¸ªà¸´à¸™à¸„à¹‰à¸²à¸—à¸µà¹ˆà¹€à¸à¸µà¹ˆà¸¢à¸§à¸‚à¹‰à¸­à¸‡à¸à¸±à¸šà¹€à¸¥à¹‚à¸à¹‰à¸—à¸¸à¸à¸›à¸£à¸°à¹€à¸ à¸—",
  "update_by": "JACK"
}
```

Response:

```json
{
  "status": "success",
  "message": "Product type group added successfully",
  "data": { "group_name": "LEGO" }
}
```

---

## ğŸ’½ **Libraries and Frameworks**

### Backend Framework

- [Fiber](https://gofiber.io/) - High-performance web framework for Go.

### Authentication

- [JWT (golang-jwt)](https://github.com/golang-jwt/jwt) - JWT implementation in Go for secure authentication.

### Database

- [MSSQL (go-mssqldb)](https://github.com/denisenkom/go-mssqldb) - Microsoft SQL Server driver for Go.

### Hashing

- [Bcrypt (golang.org/x/crypto/bcrypt)](https://pkg.go.dev/golang.org/x/crypto/bcrypt) - Secure password hashing.

### Environment Variables

- [Godotenv](https://github.com/joho/godotenv) - Load environment variables from `.env` file.

### Logging

- Built-in `log` package in Go for lightweight logging.

## ğŸ’¾ **Installation and Setup**

### Prerequisites

- Go (1.19 or higher)
- Microsoft SQL Server
- Git (optional, for cloning the repository)

### Steps

1. Clone the repository:

   ```bash
   git clone https://github.com/yourusername/PenbunAPI.git
   cd PenbunAPI
   ```

2. Install dependencies:

   ```bash
   go mod tidy
   ```

3. Configure the `.env` file:

   ```
   DB_HOST=your_db_host
   DB_PORT=1433
   DB_USER=your_db_user
   DB_PASSWORD=your_db_password
   DB_NAME=your_db_name
   JWT_SECRET=your_jwt_secret
   LOG_FILE=logs/transaction.log
   ```

4. Run the server:

   ```bash
   go run main.go
   ```

5. **Optional**: Create a new user using `bcrypt` for password hashing.
   Install `htpasswd`:
   ```bash
   sudo apt update
   sudo apt install apache2-utils -y
   ```
   Generate `bcrypt` hash:
   ```bash
   htpasswd -nbBC 10 username password
   ```
   Sample output:
   ```
   username:$2y$10$KfQ8mU5VvJ5QGk7/LN9OeOujOPEwLjD3Oo4yEWDwEpr6/LkfuPWoK
   ```
   Insert into Database:
   ```sql
   DELETE FROM tb_users;
   DBCC CHECKIDENT ('tb_users', RESEED, 0);
   INSERT INTO tb_users (user_name, user_password, user_level)
   VALUES ('username', '$2y$10$KfQ8mU5VvJ5QGk7/LN9OeOujOPEwLjD3Oo4yEWDwEpr6/LkfuPWoK', 'ADMIN');
   ```

## Â©ï¸ **License**

This project is licensed under the PENBUN License. See the LICENSE file for details.
